## 虎扑内容自动化视频制作发布系统 PRD
### 项目概述
1.1 项目背景
随着短视频快速发展，体育赛事相关的内容创作需求日益增长。本项目旨在开发一套自动化系统，通过Python控制移动设备，从虎扑APP自动采集体育赛事相关内容，生成视频并自动发布到B站平台，实现内容生产的自动化和规模化。

1.2 项目目标
**自动化内容采集**：基于当日赛事日程，自动打开虎扑APP并浏览相关页面
**智能视频生成**：将截图和滑动操作录制为流畅的视频内容
**无人值守发布**：自动将生成的视频上传至B站，实现全流程自动化
**提升内容产出效率**：减少人工操作，提高内容生产的时效性和规模

### 核心功能模块
2.1 移动设备控制模块
**功能描述**：负责与Android移动设备建立连接，控制设备操作，实现自动化交互。

**核心能力**：
- 设备连接管理：通过ADB检测并连接Android设备，支持多设备管理
- 应用启动控制：自动启动虎扑APP，处理启动异常和权限弹窗
- 屏幕操作模拟：支持点击、滑动、长按、返回等基础操作
- 屏幕录制：实时录制屏幕操作过程，生成原始视频素材
- 截图采集：按需截取关键页面截图，保存为图片素材
- 页面元素识别：通过UI元素定位（XPath、ID、文本等）实现精准操作
- 操作等待与重试：智能等待页面加载，处理网络延迟和操作失败重试

**技术实现**：
- 使用uiautomator2或Appium进行设备控制
- 通过ADB命令进行设备状态检测和基础操作
- 使用scrcpy或系统录屏API进行屏幕录制

2.2 赛事信息内容采集模块
**功能描述**：根据当日赛事日程，自动导航到虎扑APP相关页面，采集赛事相关内容。

**核心能力**：
- 赛事日程获取：从虎扑API或网页爬取当日/近期赛事信息
- 智能导航：根据赛事类型（NBA、CBA、足球等）自动跳转到对应板块
- 内容页面识别：识别比赛详情页、新闻页、数据统计页等关键页面
- 多页面采集：按预设路径浏览多个相关页面（比赛前瞻、实时数据、赛后分析等）
- 素材标记：为每个截图/视频片段添加元数据（赛事名称、时间、页面类型等）
- 采集策略配置：支持自定义采集路径、停留时间、滑动次数等参数

**采集内容类型**：
- 比赛实时数据页面截图
- 比赛集锦视频片段
- 新闻资讯页面
- 球员/球队数据统计
- 用户评论热点内容

2.3 视频生成模块
**功能描述**：将采集的截图、录屏片段等素材进行编辑、合成，生成完整的视频内容。

**核心能力**：
- 素材管理：统一管理截图、录屏片段、音频等各类素材文件
- 素材预处理：
  - 图片尺寸统一、格式转换、质量优化
  - 视频片段裁剪、去重、格式标准化
  - 添加水印、Logo等品牌元素
- 视频合成：
  - 多素材智能拼接（图片转视频、视频片段合并）
  - 添加转场效果（淡入淡出、滑动等）
  - 添加背景音乐或音效
  - 添加字幕和标题（赛事名称、时间等）
- 视频后处理：
  - 分辨率统一（1080p/720p）
  - 帧率调整（30fps/60fps）
  - 视频压缩优化
  - 生成封面图
- 模板支持：支持多种视频模板（数据展示型、集锦型、资讯型等）

**输出规格**：
- 视频格式：MP4（H.264编码）
- 分辨率：1920x1080或1280x720
- 时长：30秒-5分钟（可配置）
- 文件大小：根据B站上传限制优化

2.4 内容发布模块
**功能描述**：将生成的视频自动上传到B站，完成发布流程。

**核心能力**：
- B站账号管理：支持多账号管理，存储登录凭证（Cookie/Session）
- 自动登录：通过Selenium/Playwright模拟浏览器登录，处理验证码
- 视频上传：
  - 调用B站上传API或模拟网页上传流程
  - 支持断点续传，处理上传失败重试
  - 上传进度监控和日志记录
- 发布信息配置：
  - 自动生成标题（基于赛事信息）
  - 自动生成描述和标签
  - 设置分区、封面图等
  - 支持定时发布
- 发布状态跟踪：记录发布结果，处理发布失败情况
- 数据统计：记录视频播放量、点赞数等后续数据

**发布策略**：
- 避免频繁发布触发平台限制
- 支持发布间隔配置
- 支持发布前人工审核模式（可选）

### 技术架构
3.1 技术栈选型
**移动端自动化**
- **uiautomator2**：Android UI自动化框架，性能好，推荐使用
- **Appium**：跨平台移动应用自动化测试框架（备选方案）
- **ADB (Android Debug Bridge)**：Android设备通信工具，用于设备连接和基础操作
- **scrcpy**：Android屏幕镜像工具，可用于高质量录屏

**视频处理**
- **FFmpeg**：强大的视频处理工具，用于视频合成、转码、裁剪
- **MoviePy**：Python视频编辑库，提供更友好的API接口
- **Pillow (PIL)**：图像处理库，用于图片处理和合成
- **opencv-python**：计算机视觉库，用于图像/视频处理

**内容分发**
- **Selenium/Playwright**：浏览器自动化框架，用于B站登录和上传
- **requests**：HTTP请求库，用于API调用
- **bilibili-api-python**：B站API封装库（如有可用版本）

**任务调度**
- **APScheduler**：Python任务调度库，用于定时任务
- **Celery**：分布式任务队列（可选，用于复杂场景）

**数据存储**
- **SQLite**：轻量级数据库，用于任务和素材记录
- **JSON文件**：配置文件和数据交换格式

**其他工具库**
- **loguru**：日志记录库
- **pydantic**：数据验证库
- **pyyaml**：YAML配置文件解析


3.2 技术架构图
┌─────────────────────────────────────────────────────────────┐
│                        任务调度层                              │
│  (APScheduler/Celery - 定时任务、任务队列、状态监控)           │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                        业务逻辑层                              │
├──────────────┬──────────────┬──────────────┬─────────────────┤
│ 赛事信息获取  │ 设备控制引擎  │ 视频生成引擎  │  B站发布引擎     │
│   模块       │   模块        │   模块       │    模块          │
└──────────────┴──────────────┴──────────────┴─────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                        基础设施层                              │
├──────────────┬──────────────┬──────────────┬─────────────────┤
│ Appium/      │ FFmpeg/      │ HTTP Client/ │  Redis/         │
│ uiautomator2 │ MoviePy      │ Selenium     │  Database       │
└──────────────┴──────────────┴──────────────┴─────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    外部依赖（手机设备、B站平台）                 │
└─────────────────────────────────────────────────────────────┘

3.3 数据流设计
```
┌─────────────┐
│  任务触发   │ (定时任务/手动触发)
└─────┬───────┘
      │
      ▼
┌─────────────────────────────────────┐
│  1. 赛事信息获取                     │
│  - 查询当日赛事日程                  │
│  - 筛选目标赛事                      │
│  - 生成采集任务列表                  │
└─────┬───────────────────────────────┘
      │
      ▼
┌─────────────────────────────────────┐
│  2. 设备连接与准备                    │
│  - 检测设备连接状态                   │
│  - 启动虎扑APP                        │
│  - 等待应用加载完成                   │
└─────┬───────────────────────────────┘
      │
      ▼
┌─────────────────────────────────────┐
│  3. 内容采集流程                      │
│  ┌──────────────────────────────┐   │
│  │ 导航到目标页面                │   │
│  │ → 开始屏幕录制                │   │
│  │ → 执行操作（滑动、点击）       │   │
│  │ → 关键节点截图                │   │
│  │ → 停止录制                    │   │
│  │ → 保存素材（视频+截图）        │   │
│  └──────────────────────────────┘   │
│  (循环多个页面)                       │
└─────┬───────────────────────────────┘
      │
      ▼
┌─────────────────────────────────────┐
│  4. 素材整理与元数据                  │
│  - 素材文件分类存储                   │
│  - 生成素材清单（JSON/Metadata）      │
│  - 标记素材类型和来源                 │
└─────┬───────────────────────────────┘
      │
      ▼
┌─────────────────────────────────────┐
│  5. 视频生成流程                      │
│  ┌──────────────────────────────┐   │
│  │ 读取素材清单                  │   │
│  │ → 素材预处理（格式转换）       │   │
│  │ → 按模板组装视频              │   │
│  │ → 添加转场、字幕、音乐         │   │
│  │ → 视频渲染输出                │   │
│  │ → 生成封面图                  │   │
│  └──────────────────────────────┘   │
└─────┬───────────────────────────────┘
      │
      ▼
┌─────────────────────────────────────┐
│  6. 视频发布流程                      │
│  ┌──────────────────────────────┐   │
│  │ B站登录验证                   │   │
│  │ → 准备发布信息（标题、描述）   │   │
│  │ → 上传视频文件                │   │
│  │ → 设置发布参数                │   │
│  │ → 提交发布                    │   │
│  │ → 记录发布结果                │   │
│  └──────────────────────────────┘   │
└─────┬───────────────────────────────┘
      │
      ▼
┌─────────────────────────────────────┐
│  7. 任务完成与清理                    │
│  - 更新任务状态                       │
│  - 清理临时文件                       │
│  - 生成任务报告                       │
└─────────────────────────────────────┘
```

### 工作流程
4.1 完整执行流程
1. **任务启动阶段**
   - 系统定时触发或手动启动任务
   - 检查设备连接状态和系统资源
   - 加载配置参数（采集策略、视频模板等）

2. **内容采集阶段**
   - 获取当日赛事信息，生成采集任务队列
   - 连接移动设备，启动虎扑APP
   - 按预设路径浏览页面，执行录制和截图
   - 实时保存素材到本地存储

3. **视频制作阶段**
   - 素材整理和预处理
   - 根据模板合成视频
   - 添加字幕、转场、音乐等元素
   - 生成最终视频文件和封面

4. **内容发布阶段**
   - 登录B站账号
   - 上传视频文件
   - 填写发布信息并提交
   - 记录发布状态

5. **任务收尾阶段**
   - 更新任务执行记录
   - 清理临时文件
   - 生成执行报告

4.2 异常处理流程
- **设备连接失败**：重试3次，失败则跳过本次任务
- **APP启动失败**：重启APP或重启设备
- **页面加载超时**：跳过当前页面，继续下一个
- **视频生成失败**：记录错误日志，保留原始素材
- **上传失败**：支持断点续传，失败后下次重试
- **网络异常**：等待网络恢复后继续执行

### 数据模型设计
5.1 任务数据模型
```python
Task {
    task_id: str          # 任务唯一标识
    task_type: str        # 任务类型（采集/生成/发布）
    status: str           # 任务状态（pending/running/completed/failed）
    create_time: datetime # 创建时间
    start_time: datetime  # 开始时间
    end_time: datetime    # 结束时间
    config: dict         # 任务配置参数
    result: dict          # 任务执行结果
    error_msg: str        # 错误信息（如有）
}
```

5.2 素材数据模型
```python
Material {
    material_id: str      # 素材唯一标识
    task_id: str          # 关联任务ID
    material_type: str    # 素材类型（video/image/audio）
    file_path: str        # 文件路径
    file_size: int        # 文件大小（字节）
    duration: float       # 时长（秒，仅视频/音频）
    metadata: dict        # 元数据（赛事信息、页面类型等）
    create_time: datetime # 创建时间
}
```

5.3 视频数据模型
```python
Video {
    video_id: str         # 视频唯一标识
    task_id: str          # 关联任务ID
    file_path: str        # 视频文件路径
    file_size: int        # 文件大小
    duration: float       # 视频时长
    resolution: str       # 分辨率（如1920x1080）
    cover_path: str       # 封面图路径
    title: str            # 视频标题
    description: str      # 视频描述
    tags: list            # 标签列表
    create_time: datetime # 创建时间
    publish_status: str   # 发布状态（未发布/已发布/发布失败）
    bilibili_vid: str     # B站视频ID（发布后）
}
```

### 配置管理
6.1 系统配置
- **设备配置**：设备序列号、连接方式、录屏参数
- **APP配置**：虎扑APP包名、启动Activity、操作超时时间
- **采集配置**：采集路径、停留时间、滑动次数、截图间隔
- **视频配置**：分辨率、帧率、编码参数、模板选择
- **发布配置**：B站账号信息、发布间隔、默认分区

6.2 配置文件结构
```yaml
# config.yaml
device:
  serial: "设备序列号"
  screen_width: 1080
  screen_height: 1920
  
app:
  package_name: "com.hupu.games"
  launch_activity: ".MainActivity"
  timeout: 30
  
collection:
  scroll_delay: 2.0      # 滑动后等待时间（秒）
  screenshot_interval: 5 # 截图间隔（秒）
  max_pages: 10          # 最大采集页面数
  
video:
  resolution: "1920x1080"
  fps: 30
  template: "default"
  
publish:
  account: "账号名"
  default_partition: "体育"
  publish_interval: 3600 # 发布间隔（秒）
```

### 存储设计
7.1 目录结构
```
project_root/
├── materials/          # 原始素材存储
│   ├── videos/        # 录屏视频
│   ├── images/        # 截图
│   └── metadata/      # 素材元数据
├── videos/            # 生成的视频
│   ├── final/         # 最终视频
│   ├── covers/        # 封面图
│   └── temp/          # 临时文件
├── logs/              # 日志文件
├── config/            # 配置文件
└── database/          # 数据库文件（SQLite/JSON）
```

7.2 数据持久化
- **任务记录**：使用SQLite或JSON文件存储任务执行历史
- **素材索引**：维护素材清单，便于快速查找和管理
- **发布记录**：记录视频发布状态和B站视频ID

### 性能要求
8.1 执行效率
- 单次采集任务完成时间：< 30分钟
- 视频生成时间：< 10分钟（5分钟视频）
- 视频上传速度：根据网络带宽，支持断点续传

8.2 资源占用
- 内存占用：< 2GB
- 存储空间：单次任务素材+视频 < 5GB
- CPU占用：视频生成时 < 80%

8.3 稳定性要求
- 任务成功率：> 90%
- 系统连续运行时间：> 24小时
- 异常自动恢复能力

### 安全与合规
9.1 账号安全
- 登录凭证加密存储
- 支持多账号轮换，避免频繁操作
- 遵守B站平台使用规范

9.2 内容合规
- 视频内容符合B站社区规范
- 避免侵权内容
- 支持内容审核机制（可选）

9.3 数据安全
- 敏感信息加密存储
- 定期清理临时文件
- 日志脱敏处理

### 开发计划
10.1 开发阶段
**第一阶段：基础功能开发（2-3周）**
- 移动设备连接与控制
- 基础操作（点击、滑动、截图）
- 屏幕录制功能

**第二阶段：内容采集开发（2-3周）**
- 虎扑APP页面导航
- 多页面采集流程
- 素材管理功能

**第三阶段：视频生成开发（2-3周）**
- 视频合成引擎
- 模板系统
- 字幕和转场效果

**第四阶段：发布功能开发（1-2周）**
- B站登录和上传
- 发布信息自动填充
- 状态跟踪

**第五阶段：优化与测试（1-2周）**
- 异常处理完善
- 性能优化
- 完整测试

10.2 技术难点
- **设备兼容性**：不同Android版本和设备的适配
- **页面元素识别**：虎扑APP更新导致元素定位失效
- **视频质量**：保证合成视频的流畅度和画质
- **反爬虫对抗**：B站可能的风控机制

### 后续优化方向
11.1 功能扩展
- 支持多平台发布（抖音、快手等）
- AI自动生成视频标题和描述
- 智能素材筛选和排序
- 视频质量自动评估

11.2 技术优化
- 分布式任务执行（多设备并行）
- 视频生成加速（GPU加速）
- 智能重试策略
- 更完善的监控和告警
